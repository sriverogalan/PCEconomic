<!doctype html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
    <head th:replace="layout/layout.html :: head"></head>
    <head>
        <title th:text="' Index | PCEconomic'"></title>
    </head>

    <nav th:replace="layout/layout.html :: navbar"></nav>
    <body class="bgbd">
        <main class="container-lg bg-cont mt-md-5 mt-1">
            <h1 class="mt-3 text-center"> Bienvenido a PCEconomic! </h1>
            <section id="productes" class="row mt-5 justify-content-center">
                <h2 class="text-center">Estos son algunos de los productos que te pueden interesar</h2>
                <div id="articles" class="row mt-2 justify-content-center mb-2">
                    <div class="spinner-border text-secondary" role="status" id="loading-wheel">
                        <span class="visually-hidden">Cargando...</span>
                    </div>
                </div>
            </section>
        </main>
        <footer th:replace="layout/layout.html :: footer"></footer>
    </body>
    <div th:replace="layout/layout.html :: jquery"></div>
    <script>
        (function($) {
            $('#foo').bind('click', function() {
                alert('User clicked on "foo."');
            });
        })(jQuery);

        $.ajax({
            url: "api/articles",
            type: "GET",
            dataType: "json",
            beforeSend: function() {
                $("#loading-wheel").show();
            },
            complete: function() {
                $("#loading-wheel").hide();
            },
            success: function (resp) {
                var articles = resp;
                for (var img of resp) {
                    if (img.principal === true && img.propietats.esPrincipal === true) {
                        $('#articles').append(
                            '<a href="/article/' + img.propietats.article.id + '/' + img.propietats.id + '" class="col-xs-12 col-sm-6 col-lg-4 text-end text-decoration-none card d-flex align-items-center">' +
                            '<span class="text-end h2 text-pc-economic-default bold col-12">' + img.propietats.preu + ' € </span>' +
                            '<img src="/img/productes/' + img.propietats.article.id + '/' + img.propietats.id + '/' + img.path + '" class="col-5" alt="img">' +
                            '<div class="col-12 justify-content-center row">' +
                            '<div id="' + img.propietats.id + '" class="row justify-content-evenly col-12"></div>' +
                            '<div class="text-start h4 col-12"> <p>' + img.propietats.article.nom + '</p></div>' +
                            '<span class="text-success col-12 text-start mb-2"> Recíbelo mañana </span>' +
                            '</div>' +
                            '</div>' +
                            '</a>'
                        );
                        for (var i of articles) {
                            if (i.principal === true && i.propietats.esPrincipal === false && i.propietats.article.id === img.propietats.article.id) {
                                $('#' + img.propietats.id).append(
                                    '<a class="col-4 mt-2 mb-2 row"' +
                                    ' href="/article/' + i.propietats.article.id + '/' + i.propietats.id
                                    + '"> <img src="/img/productes/' + i.propietats.article.id + '/' + i.propietats.id + '/' + i.path + '" class="col-12" alt="img"> </a>'
                                );
                            }
                        }
                    }
                }
            },
        });
    </script>
</html>
